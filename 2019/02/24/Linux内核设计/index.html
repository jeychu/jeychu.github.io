<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="从开机加电到执行main函数之前的过程从开机到main函数的执行分三步完成，其目的是实现从启动盘加载操作系统程序，完成执行main函数所需要的准备工作。 第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序加电的一瞬间，计算机的RAM中，空空如也，什么程序也没有。而CPU的逻辑电路被设计为只能运行内存中的程序。如果要运行软盘中的操作系统，必须将软盘中操作系统程序加载到RAM中。在RAM中什">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux内核设计">
<meta property="og:url" content="http://yoursite.com/2019/02/24/Linux内核设计/index.html">
<meta property="og:site_name" content="javfa&#39;s blog">
<meta property="og:description" content="从开机加电到执行main函数之前的过程从开机到main函数的执行分三步完成，其目的是实现从启动盘加载操作系统程序，完成执行main函数所需要的准备工作。 第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序加电的一瞬间，计算机的RAM中，空空如也，什么程序也没有。而CPU的逻辑电路被设计为只能运行内存中的程序。如果要运行软盘中的操作系统，必须将软盘中操作系统程序加载到RAM中。在RAM中什">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-02-24T06:44:11.892Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux内核设计">
<meta name="twitter:description" content="从开机加电到执行main函数之前的过程从开机到main函数的执行分三步完成，其目的是实现从启动盘加载操作系统程序，完成执行main函数所需要的准备工作。 第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序加电的一瞬间，计算机的RAM中，空空如也，什么程序也没有。而CPU的逻辑电路被设计为只能运行内存中的程序。如果要运行软盘中的操作系统，必须将软盘中操作系统程序加载到RAM中。在RAM中什">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/02/24/Linux内核设计/">





  <title>Linux内核设计 | javfa's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">javfa's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/24/Linux内核设计/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Javfa">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="javfa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux内核设计</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-24T08:49:09+08:00">
                2019-02-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="从开机加电到执行main函数之前的过程"><a href="#从开机加电到执行main函数之前的过程" class="headerlink" title="从开机加电到执行main函数之前的过程"></a>从开机加电到执行main函数之前的过程</h1><p>从开机到main函数的执行分三步完成，其目的是实现从启动盘加载操作系统程序，完成执行main函数所需要的准备工作。</p>
<h2 id="第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序"><a href="#第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序" class="headerlink" title="第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序"></a>第一步，启动BIOS，准备<em>实模式</em>下的中断向量表和中断服务程序</h2><p>加电的一瞬间，计算机的RAM中，空空如也，什么程序也没有。而CPU的逻辑电路被设计为只能运行内存中的程序。如果要运行软盘中的操作系统，必须将软盘中操作系统程序加载到RAM中。<br>在RAM中什么程序都没有的时候，要由BIOS来完成加载软盘中操作系统到RAM中的任务。</p>
<h3 id="BIOS启动原理"><a href="#BIOS启动原理" class="headerlink" title="BIOS启动原理"></a>BIOS启动原理</h3><p>此时RAM中无程序，所以通过软件方法不可能执行BIOS，只能靠<strong>硬件方法</strong>完成。<br>从硬件角度看，Intel 80x86系列的cpu可以分别在16位实模式和32位保护模式下运行。</p>
<p>所有80x86系列CPU的硬件都设计为加电即进入16位实模式状态运行。且在加电瞬间强行将CS置为0xFFFF，IP置为0x0000，如此CS：IP就指向0xFFFF0这个地址位置。</p>
<blockquote>
<p>实模式（Real mode）的特性是一个20位的存储器地址空间，可以直接通过软件的方式访问BIOS以及周边硬件。</p>
<blockquote>
<p>$2^{20} =1048576$</p>
<p>即1M的存储器可被寻址</p>
</blockquote>
</blockquote>
<p>0xFFFF0指向了BIOS的地址范围。<br>这是一个纯硬件完成的动作。</p>
<p>BIOS程序的入口地址就是0xFFFF0.</p>
<h3 id="BIOS在内存中加载中断向量表和中断服务程序"><a href="#BIOS在内存中加载中断向量表和中断服务程序" class="headerlink" title="BIOS在内存中加载中断向量表和中断服务程序"></a>BIOS在内存中加载中断向量表和中断服务程序</h3><p>BIOS程序被固化在计算机主板之上的一块很小的ROM芯片里。不同的主板所用的BIOS也有所不同，就启动部分，各种类型的BIOS的基本原理大致相似。</p>
<p>在此，我们选用8KB的BIOS来说明此问题，此BIOS所占地址段为0xFE000-0xFFFFF。</p>
<p>而此时，在实模式下内存寻址空间为：0x00000-0xFFFFF</p>
<p>CS：IP指向0xFFFF0，意味着BIOS开始启动了。<br>随着BIOS程序的执行，屏幕上显示显卡的信息、内存的信息……<br>在这期间，BIOS在内存中建立了中断向量表和中断服务程序：<br>BIOS在内存最开始的位置（0x00000）用1K的内存空间构建中断向量表，并在紧挨它的位置用256字节的内存空间构建BIOS数据区，在大约56K以后的位置加载了8KB左右的与中断向量表相应的若干中断服务程序。<br>中断向量表中有256个中断向量，每个中断向量占4个字节，其中两个字节是CS值，两个为IP值，每个中断向量都指向一个具体的中断服务程序。</p>
<blockquote>
<p><em>中断</em>，可以理解为函数调用。</p>
</blockquote>
<h2 id="第二步，利用第一步中准备的中断服务程序来实现：从启动盘加载操作系统程序到内存"><a href="#第二步，利用第一步中准备的中断服务程序来实现：从启动盘加载操作系统程序到内存" class="headerlink" title="第二步，利用第一步中准备的中断服务程序来实现：从启动盘加载操作系统程序到内存"></a>第二步，利用第一步中准备的中断服务程序来实现：从启动盘加载操作系统程序到内存</h2><p>从现在开始就要执行真正的boot操作了，即把软盘中的操作系统加载至内存。</p>
<p>分三批逐次加载操作系统的内核代码：</p>
<ul>
<li><p>第一批由BIOS中断int 0x19h把第一扇区bootsect的内容加载到内存。</p>
<p>CPU接收到int 19h中断，立即在中断向量表中找到int 19h中断向量-&gt;这个中断向量把CPU指向0x0E6F2，这个位置就是int 19h相对应的中断服务程序的入口地址。</p>
<p>这个中断服务程序的作用就是把软盘的第一个扇区中的程序（512B）加载到内存中的指定位置（0x07C00）。</p>
<p>这个中断服务程序的功能是BIOS事先设计好的，代码是固定的，与Linux操作系统无关。</p>
<p>这个扇区里的内容就是Linux 0.11操作系统的引导程序，也就是bootsect，其作用就是陆续把软盘中的操作系统程序载入内存。</p>
<p>bootsect的载入，标志着操作系统中的代码即将发挥作用了。</p>
</li>
<li><p>加载第二部分代码-setup</p>
<p>现在BIOS已经把bootsect（如上所示）载入内存了，它的作用就是把第二批和第三批程序陆续加载到内存中。为了把第二批和第三批程序加载到内存中的适当位置，bootsect首先做的工作就是规划内存。</p>
<ol>
<li>bootsect对内存的规划</li>
</ol>
<p>在实模式下，寻址的最大范围是1MB，为了规划内存，bootsect首先设计了如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SETUPLEN, 4     # nr of setup-sectors</span><br><span class="line"></span><br><span class="line">BOOTSEG, 0x07c0 # original address of boot-sector</span><br><span class="line"></span><br><span class="line">INITSEG, 0x9000 # we move boot here - out of the way</span><br><span class="line"></span><br><span class="line">SETUPSEG, 0x9020    # setup starts here</span><br><span class="line"></span><br><span class="line">SYSSEG, 0x1000      # system loaded at 0x10000 (65536).</span><br><span class="line"></span><br><span class="line">ENDSEG, SYSSEG + SYSSIZE    # where to stop loading</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  这些源代码的作用就是对后续操作所涉及的内存位置进行设置，包括将要加载的setup程序的扇区数和被加载到的位置、启动扇区被BIOS加载的位置和将要移动到的新位置、内核被加载的位置、内核末尾位置和跟文件系统设备号。</p>
<p>  要时刻牢记这样一个概念：<strong>操作系统的设计者要全面</strong>、<strong>整体地考虑内存的规划</strong>。</p>
<ol start="2">
<li><p>复制bootsect</p>
<p>接下来，bootsect启动程序将它自身从内存0x07C00处复制至内存0x90000处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">start:					;// 以下10行作用是将自身(bootsect)从目前段位置07c0h(31k)</span><br><span class="line">						;// 移动到9000h(576k)处，共256字(512字节)，然后跳转到</span><br><span class="line">						;// 移动后代码的 go 标号处，也即本程序的下一语句处。 </span><br><span class="line">	mov	ax,BYTE PTR BOOTSEG		;// 将ds段寄存器置为7C0h</span><br><span class="line">	mov	ds,ax</span><br><span class="line">	mov	ax,BYTE PTR INITSEG		;// 将es段寄存器置为9000h</span><br><span class="line">	mov	es,ax</span><br><span class="line">	mov	cx,256			;// 移动计数值 ＝ 256字 = 512 字节</span><br><span class="line">	sub	si,si			;// 源地址   ds:si = 07C0h:0000h</span><br><span class="line">	sub	di,di			;// 目的地址 es:di = 9000h:0000h</span><br><span class="line">	rep movsw			;// 重复执行，直到cx = 0;移动1个字</span><br></pre></td></tr></table></figure>
<p>在这次复制过程中，ds和si联合使用，构成了源地址；es和di联合使用，构成了目的地址，而<code>mov cx,256</code>循环控制量，提供了需要复制的字数（一个字位两个字节）。</p>
</li>
</ol>
<p>​     bootsect复制到新位置后，将ds、es、ss都置成移动后代码所在段处。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">;	jmp INITSEG:[go] 	;// 间接跳转。这里INITSEG指出跳转到的段地址。</span><br><span class="line">    db 0eah				;// 间接跳转指令码</span><br><span class="line">	dw go</span><br><span class="line">	dw INITSEG</span><br><span class="line">go:	mov	ax,cs			;// 将ds、es和ss都置成移动后代码所在的段处（9000h）。</span><br><span class="line">	mov	ds,ax			;// 由于程序中有堆栈操作（push，pop，call），因此必须设置堆栈。</span><br><span class="line">	mov	es,ax</span><br><span class="line">;// put stack at 9ff00.  将堆栈指针sp指向9ff00h（即9000h:0ff00h）处</span><br><span class="line">	mov	ss,ax</span><br><span class="line">	mov	sp,0FF00h		;/* 由于代码段移动过了，所以要重新设置堆栈段的位置。</span><br><span class="line">						;   sp只要指向远大于512偏移（即地址90200h）处</span><br><span class="line">						;   都可以。因为从90200h地址开始处还要放置setup程序，</span><br><span class="line">						;   而此时setup程序大约为4个扇区，因此sp要指向大</span><br><span class="line">						;   于（200h + 200h*4 + 堆栈大小）处。 */</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>将setup程序加载到内存中</li>
</ol>
<p>加载setup程序，要借助BIOS提供的int 0x 13h中断向量所指向的中断服务程序（也就是磁盘服务程序）来完成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">load_setup:</span><br><span class="line">	;// 以下10行的用途是利用BIOS中断INT 13h将setup模块从磁盘第2个扇区</span><br><span class="line">	;// 开始读到90200h开始处，共读4个扇区。如果读出错，则复位驱动器，并</span><br><span class="line">	;// 重试，没有退路。</span><br><span class="line">	;// INT 13h 的使用方法如下：</span><br><span class="line">	;// ah = 02h - 读磁盘扇区到内存；al = 需要读出的扇区数量；</span><br><span class="line">	;// ch = 磁道（柱面）号的低8位；  cl = 开始扇区（0－5位），磁道号高2位（6－7）；</span><br><span class="line">	;// dh = 磁头号；				  dl = 驱动器号（如果是硬盘则要置为7）；</span><br><span class="line">	;// es:bx -&gt;指向数据缓冲区；  如果出错则CF标志置位。 </span><br><span class="line">	mov	dx,0000h				;// drive 0, head 0</span><br><span class="line">	mov	cx,0002h				;// sector 2, track 0</span><br><span class="line">	mov	bx,0200h				;// address = 512, in INITSEG</span><br><span class="line">	mov	ax,0200h+SETUPLEN		;// service 2, nr of sectors</span><br><span class="line">	int	13h					;// read it</span><br><span class="line">	jnc	ok_load_setup			;// ok - continue</span><br><span class="line">	mov	dx,0000h</span><br><span class="line">	mov	ax,0000h				;// reset the diskette</span><br><span class="line">	int	13h</span><br><span class="line">	jmp	load_setup</span><br></pre></td></tr></table></figure>
<ul>
<li><p>加载第三部分代码-system模块</p>
<p>仍然使用BIOS提供的int 0x 13h中断。</p>
<p>bootsect借着BIOS中断int 0x 13h，将240个扇区的system模块加载进内存。</p>
<p>加载工作主要是由bootsect调用read_it子程序完成的。</p>
<p>到此为止，第三批程序已经加载完毕，整个操作系统的代码已全部载入内存。bootsect的主体工作已经做完了，还有一点小事，就是要再次确定以下根设备号。</p>
<p>经过一系列检测，得知软盘为根设备，所以就把根设备号保存在root_dev中，作为机器系统数据之一。</p>
<p>现在，bootsect程序的任务都已经完成。</p>
<p>下面通过执行<code>jmpi 0, SETUPSEG</code>这行语句跳转至0x90200处，就是第二批程序setup程序加载的位置。</p>
<p>CS：IP指向setup程序的第一条指令，意味着由setup程序接着bootsect程序继续执行。</p>
</li>
</ul>
<h2 id="第三步，为执行32位的main函数做过渡工作"><a href="#第三步，为执行32位的main函数做过渡工作" class="headerlink" title="第三步，为执行32位的main函数做过渡工作"></a>第三步，为执行32位的main函数做过渡工作</h2><h3 id="关中断，并将system移动到内存地址起始位置0x00000"><a href="#关中断，并将system移动到内存地址起始位置0x00000" class="headerlink" title="关中断，并将system移动到内存地址起始位置0x00000"></a>关中断，并将system移动到内存地址起始位置0x00000</h3><p>即将CPU的标志寄存器（EFLAGS）中的中断允许标志置0。意味着，在接下来的执行过程中，无论是否发生中断，系统都不再响应此中断，直到main函数中适应保护模式的中断服务体系被重建完毕才会打开。那时响应中断的服务程序不再是BIOS提供的中断服务程序，取而代之的是由系统自身提供的中断服务程序。</p>
<blockquote>
<p>EFLAGS：标志寄存器，存在于CPU中，32位，包含一组状态标志、控制标志和系统标志。第9位IF位中断允许标志。</p>
</blockquote>
<blockquote>
<p>关中断（cli）和开中断（sti）操作在操作系统代码中频繁出现，总是在一个完整的操作过程的两头出现，目的是为了避免中断在此期间介入。</p>
</blockquote>
<h3 id="设置中断描述符表和全局描述符表"><a href="#设置中断描述符表和全局描述符表" class="headerlink" title="设置中断描述符表和全局描述符表"></a>设置中断描述符表和全局描述符表</h3><h3 id="打开A20，实现32位寻址"><a href="#打开A20，实现32位寻址" class="headerlink" title="打开A20，实现32位寻址"></a>打开A20，实现32位寻址</h3><h3 id="为在保护模式下执行head-s做准备"><a href="#为在保护模式下执行head-s做准备" class="headerlink" title="为在保护模式下执行head.s做准备"></a>为在保护模式下执行head.s做准备</h3><h3 id="head-s开始执行"><a href="#head-s开始执行" class="headerlink" title="head.s开始执行"></a>head.s开始执行</h3><h1 id="从main到怠速"><a href="#从main到怠速" class="headerlink" title="从main到怠速"></a>从main到怠速</h1><h2 id="开中断之前的准备工作"><a href="#开中断之前的准备工作" class="headerlink" title="开中断之前的准备工作"></a>开中断之前的准备工作</h2><h3 id="复制根设备号和硬盘参数表"><a href="#复制根设备号和硬盘参数表" class="headerlink" title="复制根设备号和硬盘参数表"></a>复制根设备号和硬盘参数表</h3><h3 id="物理内存规划格局"><a href="#物理内存规划格局" class="headerlink" title="物理内存规划格局"></a>物理内存规划格局</h3><h3 id="虚拟盘设置与初始化"><a href="#虚拟盘设置与初始化" class="headerlink" title="虚拟盘设置与初始化"></a>虚拟盘设置与初始化</h3><h3 id="内存管理结构mem-map初始化"><a href="#内存管理结构mem-map初始化" class="headerlink" title="内存管理结构mem_map初始化"></a>内存管理结构mem_map初始化</h3><h3 id="异常处理类中断服务程序挂接"><a href="#异常处理类中断服务程序挂接" class="headerlink" title="异常处理类中断服务程序挂接"></a>异常处理类中断服务程序挂接</h3><h3 id="初始化块设备请求项结构"><a href="#初始化块设备请求项结构" class="headerlink" title="初始化块设备请求项结构"></a>初始化块设备请求项结构</h3><h3 id="与建立人机交互界面相关的外设的中断服务程序挂接"><a href="#与建立人机交互界面相关的外设的中断服务程序挂接" class="headerlink" title="与建立人机交互界面相关的外设的中断服务程序挂接"></a>与建立人机交互界面相关的外设的中断服务程序挂接</h3><h3 id="开机启动时间设置"><a href="#开机启动时间设置" class="headerlink" title="开机启动时间设置"></a>开机启动时间设置</h3><h3 id="系统开始激活进程0"><a href="#系统开始激活进程0" class="headerlink" title="系统开始激活进程0"></a>系统开始激活进程0</h3><h3 id="进程相关事务初始化设置"><a href="#进程相关事务初始化设置" class="headerlink" title="进程相关事务初始化设置"></a>进程相关事务初始化设置</h3><h3 id="时钟中断设置"><a href="#时钟中断设置" class="headerlink" title="时钟中断设置"></a>时钟中断设置</h3><h3 id="系统调用服务程序挂接"><a href="#系统调用服务程序挂接" class="headerlink" title="系统调用服务程序挂接"></a>系统调用服务程序挂接</h3><h3 id="初始化缓冲区管理结构"><a href="#初始化缓冲区管理结构" class="headerlink" title="初始化缓冲区管理结构"></a>初始化缓冲区管理结构</h3><h3 id="初始化硬盘"><a href="#初始化硬盘" class="headerlink" title="初始化硬盘"></a>初始化硬盘</h3><h3 id="初始化软盘"><a href="#初始化软盘" class="headerlink" title="初始化软盘"></a>初始化软盘</h3><h3 id="开中断"><a href="#开中断" class="headerlink" title="开中断"></a>开中断</h3><h2 id="进程创建的最基本动作"><a href="#进程创建的最基本动作" class="headerlink" title="进程创建的最基本动作"></a>进程创建的最基本动作</h2><h3 id="操作系统为进程0创建进程1做准备"><a href="#操作系统为进程0创建进程1做准备" class="headerlink" title="操作系统为进程0创建进程1做准备"></a>操作系统为进程0创建进程1做准备</h3><h3 id="在进程槽中为进程1申请一个空闲位置并获取进程号"><a href="#在进程槽中为进程1申请一个空闲位置并获取进程号" class="headerlink" title="在进程槽中为进程1申请一个空闲位置并获取进程号"></a>在进程槽中为进程1申请一个空闲位置并获取进程号</h3><h3 id="复制进程信息之前，先将以下数据压栈"><a href="#复制进程信息之前，先将以下数据压栈" class="headerlink" title="复制进程信息之前，先将以下数据压栈"></a>复制进程信息之前，先将以下数据压栈</h3><h3 id="初步设置进程1管理结构"><a href="#初步设置进程1管理结构" class="headerlink" title="初步设置进程1管理结构"></a>初步设置进程1管理结构</h3><h3 id="进程0创建进程1的过程中发生时钟中断"><a href="#进程0创建进程1的过程中发生时钟中断" class="headerlink" title="进程0创建进程1的过程中发生时钟中断"></a>进程0创建进程1的过程中发生时钟中断</h3><h3 id="从时钟中断返回"><a href="#从时钟中断返回" class="headerlink" title="从时钟中断返回"></a>从时钟中断返回</h3><h3 id="调整进程1管理结构"><a href="#调整进程1管理结构" class="headerlink" title="调整进程1管理结构"></a>调整进程1管理结构</h3><h3 id="设置进程1的线性地址空间及物理页面"><a href="#设置进程1的线性地址空间及物理页面" class="headerlink" title="设置进程1的线性地址空间及物理页面"></a>设置进程1的线性地址空间及物理页面</h3><h3 id="继续调整进程1管理结构"><a href="#继续调整进程1管理结构" class="headerlink" title="继续调整进程1管理结构"></a>继续调整进程1管理结构</h3><h2 id="加载根文件系统"><a href="#加载根文件系统" class="headerlink" title="加载根文件系统"></a>加载根文件系统</h2><h3 id="进程1如何开始执行"><a href="#进程1如何开始执行" class="headerlink" title="进程1如何开始执行"></a>进程1如何开始执行</h3><h3 id="进程1开始执行"><a href="#进程1开始执行" class="headerlink" title="进程1开始执行"></a>进程1开始执行</h3><h3 id="进程1开始以数据块的形式操作硬盘"><a href="#进程1开始以数据块的形式操作硬盘" class="headerlink" title="进程1开始以数据块的形式操作硬盘"></a>进程1开始以数据块的形式操作硬盘</h3><h3 id="将找到的缓冲块与请求项挂接"><a href="#将找到的缓冲块与请求项挂接" class="headerlink" title="将找到的缓冲块与请求项挂接"></a>将找到的缓冲块与请求项挂接</h3><h3 id="将请求项与硬盘处理函数挂接"><a href="#将请求项与硬盘处理函数挂接" class="headerlink" title="将请求项与硬盘处理函数挂接"></a>将请求项与硬盘处理函数挂接</h3><h3 id="进行硬盘读盘前的准备工作"><a href="#进行硬盘读盘前的准备工作" class="headerlink" title="进行硬盘读盘前的准备工作"></a>进行硬盘读盘前的准备工作</h3><h3 id="给硬盘下达读盘指令"><a href="#给硬盘下达读盘指令" class="headerlink" title="给硬盘下达读盘指令"></a>给硬盘下达读盘指令</h3><h3 id="进程1由于等待读盘操作挂起"><a href="#进程1由于等待读盘操作挂起" class="headerlink" title="进程1由于等待读盘操作挂起"></a>进程1由于等待读盘操作挂起</h3><h3 id="系统切换到进程0执行"><a href="#系统切换到进程0执行" class="headerlink" title="系统切换到进程0执行"></a>系统切换到进程0执行</h3><h3 id="进程0的执行过程"><a href="#进程0的执行过程" class="headerlink" title="进程0的执行过程"></a>进程0的执行过程</h3><h3 id="进程0执行过程中发生硬盘中断"><a href="#进程0执行过程中发生硬盘中断" class="headerlink" title="进程0执行过程中发生硬盘中断"></a>进程0执行过程中发生硬盘中断</h3><h3 id="硬盘中断服务程序响应后，进程0继续执行"><a href="#硬盘中断服务程序响应后，进程0继续执行" class="headerlink" title="硬盘中断服务程序响应后，进程0继续执行"></a>硬盘中断服务程序响应后，进程0继续执行</h3><h3 id="再次响应硬盘中断并唤醒进程1"><a href="#再次响应硬盘中断并唤醒进程1" class="headerlink" title="再次响应硬盘中断并唤醒进程1"></a>再次响应硬盘中断并唤醒进程1</h3><h3 id="读盘操作完成后，进程1继续执行"><a href="#读盘操作完成后，进程1继续执行" class="headerlink" title="读盘操作完成后，进程1继续执行"></a>读盘操作完成后，进程1继续执行</h3><h3 id="进程1继续设置硬盘管理结构"><a href="#进程1继续设置硬盘管理结构" class="headerlink" title="进程1继续设置硬盘管理结构"></a>进程1继续设置硬盘管理结构</h3><h3 id="进程1获取软盘超级块，为加载根文件系统做准备"><a href="#进程1获取软盘超级块，为加载根文件系统做准备" class="headerlink" title="进程1获取软盘超级块，为加载根文件系统做准备"></a>进程1获取软盘超级块，为加载根文件系统做准备</h3><h3 id="进程1备份超级块数据"><a href="#进程1备份超级块数据" class="headerlink" title="进程1备份超级块数据"></a>进程1备份超级块数据</h3><h3 id="进程1将根文件系统从软盘拷贝到虚拟盘"><a href="#进程1将根文件系统从软盘拷贝到虚拟盘" class="headerlink" title="进程1将根文件系统从软盘拷贝到虚拟盘"></a>进程1将根文件系统从软盘拷贝到虚拟盘</h3><h3 id="进程1开始加载根文件系统"><a href="#进程1开始加载根文件系统" class="headerlink" title="进程1开始加载根文件系统"></a>进程1开始加载根文件系统</h3><h3 id="进程1准备加载根文件系统超级块"><a href="#进程1准备加载根文件系统超级块" class="headerlink" title="进程1准备加载根文件系统超级块"></a>进程1准备加载根文件系统超级块</h3><h3 id="进程1加载根文件系统超级块"><a href="#进程1加载根文件系统超级块" class="headerlink" title="进程1加载根文件系统超级块"></a>进程1加载根文件系统超级块</h3><h3 id="进程1继续加载根文件系统"><a href="#进程1继续加载根文件系统" class="headerlink" title="进程1继续加载根文件系统"></a>进程1继续加载根文件系统</h3><h3 id="进程1准备读取根目录i节点"><a href="#进程1准备读取根目录i节点" class="headerlink" title="进程1准备读取根目录i节点"></a>进程1准备读取根目录i节点</h3><h3 id="进程1加载根目录i节点"><a href="#进程1加载根目录i节点" class="headerlink" title="进程1加载根目录i节点"></a>进程1加载根目录i节点</h3><h3 id="进程1结束加载根文件系统的过程"><a href="#进程1结束加载根文件系统的过程" class="headerlink" title="进程1结束加载根文件系统的过程"></a>进程1结束加载根文件系统的过程</h3><h2 id="打开终端设备文件及复制文件句柄"><a href="#打开终端设备文件及复制文件句柄" class="headerlink" title="打开终端设备文件及复制文件句柄"></a>打开终端设备文件及复制文件句柄</h2><h2 id="创建进程2"><a href="#创建进程2" class="headerlink" title="创建进程2"></a>创建进程2</h2><h2 id="进程1等待进程2推出"><a href="#进程1等待进程2推出" class="headerlink" title="进程1等待进程2推出"></a>进程1等待进程2推出</h2><h2 id="shell程序的加载"><a href="#shell程序的加载" class="headerlink" title="shell程序的加载"></a>shell程序的加载</h2><h2 id="系统实现怠速"><a href="#系统实现怠速" class="headerlink" title="系统实现怠速"></a>系统实现怠速</h2><h1 id="安装文件系统"><a href="#安装文件系统" class="headerlink" title="安装文件系统"></a>安装文件系统</h1><h2 id="获取硬盘设备号"><a href="#获取硬盘设备号" class="headerlink" title="获取硬盘设备号"></a>获取硬盘设备号</h2><h2 id="获取虚拟盘上的挂接点"><a href="#获取虚拟盘上的挂接点" class="headerlink" title="获取虚拟盘上的挂接点"></a>获取虚拟盘上的挂接点</h2><h2 id="得到hd1设备文件的超级块"><a href="#得到hd1设备文件的超级块" class="headerlink" title="得到hd1设备文件的超级块"></a>得到hd1设备文件的超级块</h2><h2 id="将hd1设备文件与mnt目录文件的i节点挂接"><a href="#将hd1设备文件与mnt目录文件的i节点挂接" class="headerlink" title="将hd1设备文件与mnt目录文件的i节点挂接"></a>将hd1设备文件与mnt目录文件的i节点挂接</h2><h1 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h1><h2 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h2><h2 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h2><h2 id="新建文件"><a href="#新建文件" class="headerlink" title="新建文件"></a>新建文件</h2><h2 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h2><h2 id="修改文件"><a href="#修改文件" class="headerlink" title="修改文件"></a>修改文件</h2><h2 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h2><h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><h1 id="用户进程与内存管理"><a href="#用户进程与内存管理" class="headerlink" title="用户进程与内存管理"></a>用户进程与内存管理</h1><h2 id="用户进程的创建"><a href="#用户进程的创建" class="headerlink" title="用户进程的创建"></a>用户进程的创建</h2><h2 id="为用户进程str1的加载做准备"><a href="#为用户进程str1的加载做准备" class="headerlink" title="为用户进程str1的加载做准备"></a>为用户进程str1的加载做准备</h2><h2 id="对缺页中断的处理"><a href="#对缺页中断的处理" class="headerlink" title="对缺页中断的处理"></a>对缺页中断的处理</h2><h2 id="str1用户进程的退出"><a href="#str1用户进程的退出" class="headerlink" title="str1用户进程的退出"></a>str1用户进程的退出</h2><h2 id="多个用户进程同时运行"><a href="#多个用户进程同时运行" class="headerlink" title="多个用户进程同时运行"></a>多个用户进程同时运行</h2><h2 id="进程的调度与切换"><a href="#进程的调度与切换" class="headerlink" title="进程的调度与切换"></a>进程的调度与切换</h2><h2 id="内核的分页"><a href="#内核的分页" class="headerlink" title="内核的分页"></a>内核的分页</h2><h2 id="页写保护"><a href="#页写保护" class="headerlink" title="页写保护"></a>页写保护</h2><h1 id="多个进程同时操作一个文件"><a href="#多个进程同时操作一个文件" class="headerlink" title="多个进程同时操作一个文件"></a>多个进程同时操作一个文件</h1><h2 id="三个进程操作同一个文件"><a href="#三个进程操作同一个文件" class="headerlink" title="三个进程操作同一个文件"></a>三个进程操作同一个文件</h2><h2 id="缓冲区与外设的数据同步"><a href="#缓冲区与外设的数据同步" class="headerlink" title="缓冲区与外设的数据同步"></a>缓冲区与外设的数据同步</h2><h1 id="IPC问题"><a href="#IPC问题" class="headerlink" title="IPC问题"></a>IPC问题</h1><h2 id="管道机制"><a href="#管道机制" class="headerlink" title="管道机制"></a>管道机制</h2><h2 id="信号机制"><a href="#信号机制" class="headerlink" title="信号机制"></a>信号机制</h2>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/23/持续交付/" rel="next" title="持续交付">
                <i class="fa fa-chevron-left"></i> 持续交付
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Javfa</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#从开机加电到执行main函数之前的过程"><span class="nav-number">1.</span> <span class="nav-text">从开机加电到执行main函数之前的过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序"><span class="nav-number">1.1.</span> <span class="nav-text">第一步，启动BIOS，准备实模式下的中断向量表和中断服务程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#BIOS启动原理"><span class="nav-number">1.1.1.</span> <span class="nav-text">BIOS启动原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BIOS在内存中加载中断向量表和中断服务程序"><span class="nav-number">1.1.2.</span> <span class="nav-text">BIOS在内存中加载中断向量表和中断服务程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二步，利用第一步中准备的中断服务程序来实现：从启动盘加载操作系统程序到内存"><span class="nav-number">1.2.</span> <span class="nav-text">第二步，利用第一步中准备的中断服务程序来实现：从启动盘加载操作系统程序到内存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三步，为执行32位的main函数做过渡工作"><span class="nav-number">1.3.</span> <span class="nav-text">第三步，为执行32位的main函数做过渡工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关中断，并将system移动到内存地址起始位置0x00000"><span class="nav-number">1.3.1.</span> <span class="nav-text">关中断，并将system移动到内存地址起始位置0x00000</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置中断描述符表和全局描述符表"><span class="nav-number">1.3.2.</span> <span class="nav-text">设置中断描述符表和全局描述符表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打开A20，实现32位寻址"><span class="nav-number">1.3.3.</span> <span class="nav-text">打开A20，实现32位寻址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为在保护模式下执行head-s做准备"><span class="nav-number">1.3.4.</span> <span class="nav-text">为在保护模式下执行head.s做准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#head-s开始执行"><span class="nav-number">1.3.5.</span> <span class="nav-text">head.s开始执行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#从main到怠速"><span class="nav-number">2.</span> <span class="nav-text">从main到怠速</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#开中断之前的准备工作"><span class="nav-number">2.1.</span> <span class="nav-text">开中断之前的准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#复制根设备号和硬盘参数表"><span class="nav-number">2.1.1.</span> <span class="nav-text">复制根设备号和硬盘参数表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#物理内存规划格局"><span class="nav-number">2.1.2.</span> <span class="nav-text">物理内存规划格局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟盘设置与初始化"><span class="nav-number">2.1.3.</span> <span class="nav-text">虚拟盘设置与初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内存管理结构mem-map初始化"><span class="nav-number">2.1.4.</span> <span class="nav-text">内存管理结构mem_map初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常处理类中断服务程序挂接"><span class="nav-number">2.1.5.</span> <span class="nav-text">异常处理类中断服务程序挂接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化块设备请求项结构"><span class="nav-number">2.1.6.</span> <span class="nav-text">初始化块设备请求项结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#与建立人机交互界面相关的外设的中断服务程序挂接"><span class="nav-number">2.1.7.</span> <span class="nav-text">与建立人机交互界面相关的外设的中断服务程序挂接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开机启动时间设置"><span class="nav-number">2.1.8.</span> <span class="nav-text">开机启动时间设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统开始激活进程0"><span class="nav-number">2.1.9.</span> <span class="nav-text">系统开始激活进程0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程相关事务初始化设置"><span class="nav-number">2.1.10.</span> <span class="nav-text">进程相关事务初始化设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时钟中断设置"><span class="nav-number">2.1.11.</span> <span class="nav-text">时钟中断设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统调用服务程序挂接"><span class="nav-number">2.1.12.</span> <span class="nav-text">系统调用服务程序挂接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化缓冲区管理结构"><span class="nav-number">2.1.13.</span> <span class="nav-text">初始化缓冲区管理结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化硬盘"><span class="nav-number">2.1.14.</span> <span class="nav-text">初始化硬盘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化软盘"><span class="nav-number">2.1.15.</span> <span class="nav-text">初始化软盘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开中断"><span class="nav-number">2.1.16.</span> <span class="nav-text">开中断</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#进程创建的最基本动作"><span class="nav-number">2.2.</span> <span class="nav-text">进程创建的最基本动作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#操作系统为进程0创建进程1做准备"><span class="nav-number">2.2.1.</span> <span class="nav-text">操作系统为进程0创建进程1做准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在进程槽中为进程1申请一个空闲位置并获取进程号"><span class="nav-number">2.2.2.</span> <span class="nav-text">在进程槽中为进程1申请一个空闲位置并获取进程号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制进程信息之前，先将以下数据压栈"><span class="nav-number">2.2.3.</span> <span class="nav-text">复制进程信息之前，先将以下数据压栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初步设置进程1管理结构"><span class="nav-number">2.2.4.</span> <span class="nav-text">初步设置进程1管理结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程0创建进程1的过程中发生时钟中断"><span class="nav-number">2.2.5.</span> <span class="nav-text">进程0创建进程1的过程中发生时钟中断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从时钟中断返回"><span class="nav-number">2.2.6.</span> <span class="nav-text">从时钟中断返回</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调整进程1管理结构"><span class="nav-number">2.2.7.</span> <span class="nav-text">调整进程1管理结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置进程1的线性地址空间及物理页面"><span class="nav-number">2.2.8.</span> <span class="nav-text">设置进程1的线性地址空间及物理页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#继续调整进程1管理结构"><span class="nav-number">2.2.9.</span> <span class="nav-text">继续调整进程1管理结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加载根文件系统"><span class="nav-number">2.3.</span> <span class="nav-text">加载根文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1如何开始执行"><span class="nav-number">2.3.1.</span> <span class="nav-text">进程1如何开始执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1开始执行"><span class="nav-number">2.3.2.</span> <span class="nav-text">进程1开始执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1开始以数据块的形式操作硬盘"><span class="nav-number">2.3.3.</span> <span class="nav-text">进程1开始以数据块的形式操作硬盘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将找到的缓冲块与请求项挂接"><span class="nav-number">2.3.4.</span> <span class="nav-text">将找到的缓冲块与请求项挂接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将请求项与硬盘处理函数挂接"><span class="nav-number">2.3.5.</span> <span class="nav-text">将请求项与硬盘处理函数挂接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进行硬盘读盘前的准备工作"><span class="nav-number">2.3.6.</span> <span class="nav-text">进行硬盘读盘前的准备工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#给硬盘下达读盘指令"><span class="nav-number">2.3.7.</span> <span class="nav-text">给硬盘下达读盘指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1由于等待读盘操作挂起"><span class="nav-number">2.3.8.</span> <span class="nav-text">进程1由于等待读盘操作挂起</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统切换到进程0执行"><span class="nav-number">2.3.9.</span> <span class="nav-text">系统切换到进程0执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程0的执行过程"><span class="nav-number">2.3.10.</span> <span class="nav-text">进程0的执行过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程0执行过程中发生硬盘中断"><span class="nav-number">2.3.11.</span> <span class="nav-text">进程0执行过程中发生硬盘中断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#硬盘中断服务程序响应后，进程0继续执行"><span class="nav-number">2.3.12.</span> <span class="nav-text">硬盘中断服务程序响应后，进程0继续执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#再次响应硬盘中断并唤醒进程1"><span class="nav-number">2.3.13.</span> <span class="nav-text">再次响应硬盘中断并唤醒进程1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读盘操作完成后，进程1继续执行"><span class="nav-number">2.3.14.</span> <span class="nav-text">读盘操作完成后，进程1继续执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1继续设置硬盘管理结构"><span class="nav-number">2.3.15.</span> <span class="nav-text">进程1继续设置硬盘管理结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1获取软盘超级块，为加载根文件系统做准备"><span class="nav-number">2.3.16.</span> <span class="nav-text">进程1获取软盘超级块，为加载根文件系统做准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1备份超级块数据"><span class="nav-number">2.3.17.</span> <span class="nav-text">进程1备份超级块数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1将根文件系统从软盘拷贝到虚拟盘"><span class="nav-number">2.3.18.</span> <span class="nav-text">进程1将根文件系统从软盘拷贝到虚拟盘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1开始加载根文件系统"><span class="nav-number">2.3.19.</span> <span class="nav-text">进程1开始加载根文件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1准备加载根文件系统超级块"><span class="nav-number">2.3.20.</span> <span class="nav-text">进程1准备加载根文件系统超级块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1加载根文件系统超级块"><span class="nav-number">2.3.21.</span> <span class="nav-text">进程1加载根文件系统超级块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1继续加载根文件系统"><span class="nav-number">2.3.22.</span> <span class="nav-text">进程1继续加载根文件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1准备读取根目录i节点"><span class="nav-number">2.3.23.</span> <span class="nav-text">进程1准备读取根目录i节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1加载根目录i节点"><span class="nav-number">2.3.24.</span> <span class="nav-text">进程1加载根目录i节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程1结束加载根文件系统的过程"><span class="nav-number">2.3.25.</span> <span class="nav-text">进程1结束加载根文件系统的过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打开终端设备文件及复制文件句柄"><span class="nav-number">2.4.</span> <span class="nav-text">打开终端设备文件及复制文件句柄</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建进程2"><span class="nav-number">2.5.</span> <span class="nav-text">创建进程2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#进程1等待进程2推出"><span class="nav-number">2.6.</span> <span class="nav-text">进程1等待进程2推出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell程序的加载"><span class="nav-number">2.7.</span> <span class="nav-text">shell程序的加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统实现怠速"><span class="nav-number">2.8.</span> <span class="nav-text">系统实现怠速</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装文件系统"><span class="nav-number">3.</span> <span class="nav-text">安装文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#获取硬盘设备号"><span class="nav-number">3.1.</span> <span class="nav-text">获取硬盘设备号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取虚拟盘上的挂接点"><span class="nav-number">3.2.</span> <span class="nav-text">获取虚拟盘上的挂接点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#得到hd1设备文件的超级块"><span class="nav-number">3.3.</span> <span class="nav-text">得到hd1设备文件的超级块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将hd1设备文件与mnt目录文件的i节点挂接"><span class="nav-number">3.4.</span> <span class="nav-text">将hd1设备文件与mnt目录文件的i节点挂接</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文件操作"><span class="nav-number">4.</span> <span class="nav-text">文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#打开文件"><span class="nav-number">4.1.</span> <span class="nav-text">打开文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#读文件"><span class="nav-number">4.2.</span> <span class="nav-text">读文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新建文件"><span class="nav-number">4.3.</span> <span class="nav-text">新建文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#写文件"><span class="nav-number">4.4.</span> <span class="nav-text">写文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改文件"><span class="nav-number">4.5.</span> <span class="nav-text">修改文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关闭文件"><span class="nav-number">4.6.</span> <span class="nav-text">关闭文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除文件"><span class="nav-number">4.7.</span> <span class="nav-text">删除文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用户进程与内存管理"><span class="nav-number">5.</span> <span class="nav-text">用户进程与内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#用户进程的创建"><span class="nav-number">5.1.</span> <span class="nav-text">用户进程的创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为用户进程str1的加载做准备"><span class="nav-number">5.2.</span> <span class="nav-text">为用户进程str1的加载做准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对缺页中断的处理"><span class="nav-number">5.3.</span> <span class="nav-text">对缺页中断的处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#str1用户进程的退出"><span class="nav-number">5.4.</span> <span class="nav-text">str1用户进程的退出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多个用户进程同时运行"><span class="nav-number">5.5.</span> <span class="nav-text">多个用户进程同时运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#进程的调度与切换"><span class="nav-number">5.6.</span> <span class="nav-text">进程的调度与切换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内核的分页"><span class="nav-number">5.7.</span> <span class="nav-text">内核的分页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#页写保护"><span class="nav-number">5.8.</span> <span class="nav-text">页写保护</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#多个进程同时操作一个文件"><span class="nav-number">6.</span> <span class="nav-text">多个进程同时操作一个文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#三个进程操作同一个文件"><span class="nav-number">6.1.</span> <span class="nav-text">三个进程操作同一个文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓冲区与外设的数据同步"><span class="nav-number">6.2.</span> <span class="nav-text">缓冲区与外设的数据同步</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IPC问题"><span class="nav-number">7.</span> <span class="nav-text">IPC问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#管道机制"><span class="nav-number">7.1.</span> <span class="nav-text">管道机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#信号机制"><span class="nav-number">7.2.</span> <span class="nav-text">信号机制</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Javfa</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
